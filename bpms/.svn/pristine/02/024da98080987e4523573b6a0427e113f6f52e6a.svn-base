<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://egovframework.gov/ctl/ui" prefix="ui"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib prefix="security" uri="http://www.springframework.org/security/tags"%>
<h1 class="text-primary">게시글 작성</h1>
<security:authorize access="isAuthenticated()">
	<security:authentication property="principal" var="principal" />
	<c:set var="authMember" value="${principal.realMember }" />
<form:form modelAttribute="boardVO" id="boardForm" method="post" enctype="multipart/form-data">
	<input type="hidden" class="form-control" name="boardNo" value="${boardVO.boardNo }" required />
	<input type="hidden" class="form-control" name="boardWriter" value="${boardVO.boardWriter }" />
<!-- 	<input type="hidden" class="form-control" name="proId" value="p-00001" /> -->
	<table class="table table-bordered">
		<tr>
			<th class="text-center">제목</th>
			<td class="pb-1">
				<input type="text" class="form-control"
				required name="boardTitle" value="${boardVO.boardTitle}" />
				<form:errors path="boardTitle" element="span" cssClass="error"/>
			</td>
		</tr>
		<tr>
			<th class="text-center">첨부파일</th>
			<td class="pb-1" id="fileArea">
				<div>
					<c:if test="${not empty boardVO.attatchList }">
						<c:forEach items="${boardVO.attatchList }" var="attatch" varStatus="vs">
							<span title="다운로드:${attatch.attDowncount }" class="attatchSpan">
								<img src="${cPath }/images/delete.png" class="delAtt" data-att-no="${attatch.attNo }"/>
								${attatch.attOriginname } &nbsp; ${not vs.last?"|":"" }
							</span>
						</c:forEach>		
					</c:if>
				</div>
				<div class="input-group">
					<input type="file" class="form-control" name="boardFiles" />
					<span class="btn btn-primary plusBtn">+</span>
				</div>
				<form:errors path="boardFiles" element="span" cssClass="error" />  
			</td>
		</tr>
		<tr>
			<th class="text-center">내용</th>
			<td class="pb-1">
				<textarea name="boardContent" id="boardContent" class="form-control">${boardVO.boardContent }</textarea>
				<form:errors path="boardContent" element="span" cssClass="error" />
			</td>
		</tr>
		<tr>
			<td colspan="2" class="text-center pt-2">
				<input type="submit" class="btn btn-primary ml-5" value="저장" />
				<input type="reset" class="btn btn-secondary" value="취소" />
			</td>
		</tr>
	</table>
</form:form>
</security:authorize>
<!-- jquery-validation-1.19.2 -->
<script type="text/javascript" src="${pageContext.request.contextPath }/js/jquery-validation-1.19.2/jquery.validate.min.js"></script>
<script type="text/javascript" src="${pageContext.request.contextPath }/js/jquery-validation-1.19.2/additional-methods.min.js"></script>
<script type="text/javascript">

	$("#fileArea").on("click", ".plusBtn", function(){
		let clickDiv = $(this).parents("div.input-group");
		let newDiv = clickDiv.clone();
		let fileTag = newDiv.find("input[type='file']");
		fileTag.val("");
		clickDiv.after(newDiv);		
	});
	
	let boardForm =$("#boardForm");
	$(".delAtt").on("click", function(){
		let att_no = $(this).data("attNo");
		boardForm.append(
			$("<input>").attr({
				"type":"hidden"
				, "name":"delAttNos"
			}).val(att_no)
		);
		$(this).parent("span:first").hide();
	});
	
	boardForm.validate({
		onsubmit:true,
		onfocusout:function(element, event){
			return this.element(element);
		},
		errorPlacement: function(error, element) {
			error.appendTo( $(element).parents("td:first") );
	  	}
	});
	
</script>