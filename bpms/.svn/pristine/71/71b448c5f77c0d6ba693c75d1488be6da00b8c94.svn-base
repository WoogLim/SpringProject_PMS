<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://egovframework.gov/ctl/ui" prefix="ui" %>
<%--
* [[개정이력(Modification Information)]]
* 수정일                          수정자        수정내용
* ----------------------------------------
* 2021. 2. 5.      이선엽       최초작성
* Copyright (c) 2021 by DDIT All right reserved
 --%>
<div class="row d-flex justify-content-center">
	<div class="card col-12">
		<div class="card-header">
			<div class="card-title">일일 업무 보고</div>
			<div class="float-right d-flex">
				<input type="button" value="신규등록"	id="createBtn" class="btn btn-success" />
			</div>
		</div>
		<div class="card-body">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th scope="col">제목</th>
						<th scope="col">작성자</th>
						<th scope="col">등록일</th>
					</tr>
				</thead>
				<tbody id="listBody"></tbody>
				<tfoot>
					<tr>
						<td colspan="3">
							<form id="searchForm">
								<input type="hidden" name="page" /> 
								<input type="hidden" name="searchType" value="${pagingVO.searchVO.searchType }"/>
								<input type="hidden" name="searchWord" value="${pagingVO.searchVO.searchWord }"/>
							</form>
							<div class="input-group" id="inputUI">
								<select class="form-control" name="searchType">
									<option>검색조건 선택</option>
				           			<option value="title" ${'title' eq param.searchType?"selected":"" }>제목</option>
				           			<option value="writer" ${'writer' eq param.searchType?"selected":"" }>작성자</option>
				           		</select>
				               	<input type="text" class="form-control" id="search" name="searchWord" value="${pagingVO.searchVO.searchWord }" placeholder="search">
								<input type="button" value="검색" id="searchBtn"	class="btn btn-primary" /> 
							</div>
							<div id="pagingArea">
	<%-- 							<ui:pagination paginationInfo="${paginationInfo }" jsFunction="pageLinkMove" type="bsNumber"/> --%>
							</div>
						</td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
	$("#createBtn").on("click", function() {
		location.href = $.getContextPath() + "/workReport/workReportInsert.do?proId=${param.proId}";
	});

	let workReportWriter = $("[name='workReportWriter']");

	$("#inputUI :input").on("change", function() {
		searchBtn.trigger("click");
	});

	let listBody = $("#listBody");
	
	listBody.on("click", "tr", function() {
		let workReportNo = $(this).data("workReport");
		location.href = $.getContextPath() + "/workReport/workReportView.do?proId=${param.proId}&boardNo=" + workReportNo.boardNo;
	});

	let pagingArea = $("#pagingArea").on("click", "a", function(event) {
		event.preventDefault();
		let page = $(this).data("page");
		searchForm.find("[name='page']").val(page);
		searchForm.submit();
		searchForm.find("[name='page']").val("");
		return false;
	});

	let searchForm = $("#searchForm").ajaxForm({
		dataType : "json",
		success : function(resp) {
			let workReportList = resp.pagingVO.dataList;
			let pagingHTML = resp.pagingVO.pagingHTML;
			let trTags = [];
			if (workReportList.length > 0) {
				$(workReportList).each(function(idx, workReport) {
					trTags.push(
						$("<tr>").append(
							$("<td style=\"width:60%\">").text(workReport.boardTitle)
							,$("<td style=\"width:20%\">").text(workReport.boardWriter)
							,$("<td style=\"width:20%\">").text(workReport.createDate)
						).data("workReport",workReport)
					);
				});
			} else {
				trTags.push($("<tr>").html(
					$("<td colspan='4'>").addClass("text-center").text("게시글이 존재하지 않습니다.")
					)
				);
			}
// 			let remainRowCnt = resp.pagingVO.screenSize - trTags.length;
// 			for (let i = 0; i < remainRowCnt; i++) {
// 				trTags.push($("<tr>").html(
// 						$("<td colspan='4'>").html("&nbsp;")));
// 			}
			listBody.html(trTags);
			pagingArea.html(pagingHTML);
		}
	}).submit();

	let searchBtn = $("#searchBtn").on("click", function() {
		let inputs = $(this).parents("div#inputUI").find(":input[name]");
		$(inputs).each(function(index, input) {
			let name = $(this).attr("name");
			let value = $(this).val();
			let hidden = searchForm.find("[name='" + name + "']");
			hidden.val(value);
		});
		searchForm.submit();
	});
</script>