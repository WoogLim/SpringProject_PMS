<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>

<div class="page-kanban">
	<div class="page-inner" style="margin: 0 !important; padding:0 !important">
		<span class="project-path"> <a href="#">마이페이지</a> <a
			href="#">마이 칸반</a>
		</span>
	
		<div class="service__header">
			<h2>마이 보드</h2>
		</div>
	
		<div class="kanban__container">
			<div class="kanbanlist">
				<c:set value="${kanbanList }" var="boardList" />
					<c:if test="${not empty boardList}">
						<c:forEach items="${boardList }" var="project">
							<div class="list" data-culumns="kanbanlist" data-kboardId="${project.kboardId }">
							    <header class="no-drag">
							       	${project.kboardTitle }
							    </header>
							
							    <div class="write__sticker">
							        <form method="post" id="">
							        	<input type="hidden" name="kboardId" value="${project.kboardId }">
							        	
							            <header>제목</header>
							            <input type="text" name="kstickerTitle" class="form-stickerinput" required>
							            <header>설명</header>
							            <textarea class="form-textarea" name="kstickerContent" id="" cols="30" rows="10" required></textarea>
							            <input type="hidden" name="kstickerSort" class="">
							            <div class="write__stickerbtn">
							                <button type="button" class="stickerwrite__submit">
							                    <i class="fas fa-check"></i>
							                </button>
							                <button type="button" class="stickerwrite__cancle">
							                    <i class="fas fa-times"></i>
							                </button>
							            </div>
							        </form>
							    </div>
							    
							    <c:set value="${project.stickerList }" var="stickerList" />
							    		<c:forEach items="${stickerList }" var="sticker">
							    			<c:if test="${not empty sticker.kstickerId }">
												<div class="item-container" draggable="true">
		                                            <div class="list-item">
		                                                <div class="sticker__title">
		                                                       <span class="sticker-title">
		                                                            ${sticker.kstickerTitle }
		                                                       </span>
		                                                </div>
		                                                <div class="sticker__id">
		                                                    <i class="fas fa-pen-square"></i>
		                                                    <p class="sticker__name">${sticker.kstickerSort }
		                                                    </p>
		                                                </div>
		                                            </div>
		                                            <button class="item-setting">
		                                                <i class="fas fa-ellipsis-h"></i>
		                                            </button>
		                                            <ul class="item-settinglist">
		                                                <li>스티커 수정</li>
		                                                <li>스티커 삭제</li>
		                                            </ul>
		                                        </div>
								    		</c:if>
							    		</c:forEach>
	
	                                      <div class="column__settingbtn">
	                                          <button class="kanban__sticker-add">
	                                              <i class="fas fa-edit"></i>
	                                          </button>
	                                          <button type="button" class="kanban__category-remove" data-toggle="modal"
	                                              data-target="#category__remove">
	                                              <i class="far fa-trash-alt"></i>
	                                          </button>
	                                      </div>
							    
							</div>
						</c:forEach>
					</c:if>
			
				<div class="kanban__column-add">
					<i class="far fa-plus-square column__addicon"></i>
					<div class="column__addinput">
						<form action="">
							<input type="text" class="form-control" placeholder="보드 이름"
								required>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="sticker-mask">
        <div class="stickerinner-container">
            <div class="sticker-over"></div>
            <div class="sticker-inner">
                <div class="sticker-content">
                    <ul class="stickerinner-content">
                        <li class="sticker-header">
                            <div class="stickerinner-icon">
                                <i class="fas fa-bookmark"></i>
                            </div>
                            <div class="stickerinner-titlename">
                                <div class="stickerinner-title">
                                    <span class="stickername">
                                        마크다운 Parser
                                    </span>
                                    <button class="close-stickerinner">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <span class="stickerfrom-board">
                                    TO DO
                                </span>
                            </div>
                        </li>

                        <li class="stickerinner-notice">

                            <div class="stickermain-content">알고리즘 관련해서
                                정리해둔 파일입니다.알고리즘 관련해서
                            </div>

                        </li>

                        <li class="stickerwrite-info">
                            <span class="stikcerupdate-date">
                                2021년 1월 6일
                            </span>
                            <span class="stikcerupdate-current">
                                53
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
	
	<!-- 카테고리 삭제 모달 -->
	<div class="modal fade" id="category__remove">
		<div class="modal-dialog modal-md">
			<div class="modal-content">
				<div class="modal-body">
	
					<div class="modal__header">카테고리 삭제</div>
	
					<div class="setting__roleSet">
	
						<span class="remove__category">삭제할 카테고리 : </span>
	
						<div class="remove__categoryname"></div>
					</div>
	
					<div class="form-groupbtn">
						<button type="button" class="form-cancel" data-toggle="modal"
							data-target="#category__remove">취소</button>
						<button type="button" class="form-confirm">제거</button>
					</div>
	
				</div>
			</div>
		</div>
	</div>
</div>
	
	
<script>

$(function(){
	
	const list_items = document.querySelectorAll('.item-container');
       const lists = document.querySelectorAll('.list');

       let draggedItem = null;

       for (let i = 0; i < list_items.length; i++) {
           const item = list_items[i];

           item.addEventListener('dragstart', function () {
               draggedItem = item;
               // 3ms초 이후 함수가 실행되므로 그전에 none 처리
               setTimeout(function () {
                   item.style.display = 'none';
               }, 0)
           });

           item.addEventListener('dragend', function () {
               setTimeout(function () {
                   draggedItem.style.display = 'block';
                   draggedItem = null;
               }, 0);
           })
       }
       
       for (let j = 0; j < lists.length; j++) {
           const list = lists[j];

           list.addEventListener('dragover', function (e) {
               e.preventDefault();
           });

           list.addEventListener('dragenter', function (e) {
               e.preventDefault();
               this.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
           });

           list.addEventListener('dragleave', function (e) {
               e.preventDefault();
               this.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
           });

           list.addEventListener('drop', function (e) {
               e.preventDefault();
               if ($(draggedItem).hasClass('item-container')) {
                   this.append(draggedItem);
                   this.style.backgroundColor = 'rgba(0, 0, 0, 0.1)';
               }
           });
       }

       $('.kanban__column-add').click(function () {
           $('.kanbanlist').addClass('coulumnadd__active')
           $('.column__addinput').css({
               "display": "block"
           })
           $('.column__addicon').css({
               "display": "none"
           })
           $(this).find('.form-control').focus();
       })
       $('body').click(function (e) {
           if (!$(e.target).hasClass('column__addicon') && !$(e.target).hasClass('column__addinput') && !$(e
                   .target).hasClass('form-control')) {
               $('.column__addinput').css({
                   "display": "none"
               })
               $('.column__addicon').css({
                   "display": "block"
               })
           }
       })

       $('.item-setting').click(function () {
           let settinglist = $(this).siblings('.item-settinglist');
           let settinglistclass = settinglist.attr('class');
           let itemsetting = settinglist.siblings('.item-setting');
           settinglist.css({
               "display": "block"
           });
           $('body').click(function (e) {
               if (!$(e.target).hasClass(settinglistclass) && !$(e.target).parent().hasClass(
                       itemsetting.attr('class'))) {
                   settinglist.css({
                       "display": "none"
                   })
               }
           })
           $(itemsetting).focusout(function (e) {
               settinglist.css({
                   "display": "none"
               })
           })
       })

       $('.kanban__sticker-add').click(function () {
       	let addstickerAdd = $(this).parents().siblings('.write__sticker');
       	
       	addstickerAdd.children().find('.form-stickerinput').val('')
       	addstickerAdd.children().find('.form-textarea').val('')
           addstickerAdd.show();

       })
       
       $('.stickerwrite__cancle').click(function () {
       	let addstikercancle = $(this).parent().parent().parent('.write__sticker')
       	
           addstikercancle.hide();
       })

       $('.kanban__category-remove').click(function () {
           let categorynumber = $(this).parents('.list').data('culumns-nunber');
           let categoryname = $(this).parents('.list').children('header').text().trim();

           $('.remove__category').append(categorynumber);
           $('.remove__categoryname').text('카테고리 제목 :' + categoryname)
       })

       $('.sticker-over').click(function(){
           $('.sticker-mask').hide();
       })

       $('.list-item').click(function(){
           $('.sticker-mask').show();
       })

       $('.close-stickerinner').click(function(){
           $('.sticker-mask').hide();
       })
       
       $('.stickerwrite__submit').click(function(){
       	// 스티커 생성시 폼 
       	let thisform = this.parentNode.parentNode
       	$.ajax({
       		url: '${pageContext.request.contextPath}/kanban/stickerInsert.do',
       		type: 'POST',
       		data: $(thisform).serialize(),
       		dataType: 'json',
       		success : function(resp){
       			console.log(resp)
       		},
       		error : function(error){
       			console.log('응 에러')
       		}
       	})
       })
})
   </script>
       
       	
</body>
</html>