<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>

<div class="storage-container">
	<div class="container-header">
		<h2 class="container-title">파일 보관함</h2>
	</div>

	<div class="storageinner-header">
		<ul class="storage-filter">
			<li class="storage-searchandload">
				<div class="storage-searchfilter">
					<div class="storagefilter-filecheck">
						<input type="checkbox" onchange="storageAllcheck(this)">
					</div>
					<div class="storagefilter-search">
						<input type="text">
						<button class="storage-searchbtn">
							<i class="icon-magnifier"></i>
						</button>
					</div>
				</div>

				<div class="fileselect-group">

					<div class="storage-download">
						<div class="storage-uplodabtn">내려받기</div>
					</div>

					<div class="fileselect-message">

						<span class="filesel-count"> </span>
						<button type="button" class="filesel-init"
							onclick="filecheckinit(event)">선택해제</button>
					</div>
				</div>
			</li>
		</ul>

		<!-- <ul class="storageservice-select">
	        <button class="storageservicebtn">
	            <div class="storagebtninner-text">
	                <i class="flaticon-list"></i>
	                <span class="">프로젝트 문서함</span>
	            </div>
	        </button>
	        <button class="storageservicebtn">
	            <div class="storagebtninner-text">
	                <i class="flaticon-folder"></i>
	                <span class="">프로젝트 공유함</span>
	            </div>
	        </button>
	    </ul> -->

		<ul class="storageservice-viewmode">
			<li class="storageuse-guide"><span class="useguide-text no-drag">
					프로젝트 문서함에서는 업로드가 불가능하며 내려받기만 가능합니다. </span></li>
			<li class="storageuse-view"></li>
		</ul>
	</div>

	<div class="storageinner-content" onclick="filecheckinit(event)">
		<ul class="storageitemlist fileview-grid"
			onclick="filecheckinit(event)">
			<li class="storageitem">
				<div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" data-code="3" data-group="B" onclick="test(this, event)">
					<div class="filetype-icon">
						<i class="fas fa-folder"></i>
					</div>
					<div class="fileitem-info">
						<span class="fileitem-name">일감 관리</span>
					</div>
					<button type="button" class="checkthis-file"
						data-url="http://download.com" onclick="downloadlist(this)"
						onmouseover="listaddOver(this)" onmouseout="listaddOut(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
					<button type="button" class="uncheckthis-file"
						data-url="http://download.com" onclick="uncheckDownloadlist(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
				</div>
			</li>
			<li class="storageitem">
				<div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" data-code="2" data-group="B" onclick="test(this, event)">
					<div class="filetype-icon">
						<i class="fas fa-folder"></i>
					</div>
					<div class="fileitem-info">
						<span class="fileitem-name">이슈 관리</span>
					</div>
					<button type="button" class="checkthis-file"
						data-url="http://download.com" onclick="downloadlist(this)"
						onmouseover="listaddOver(this)" onmouseout="listaddOut(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
					<button type="button" class="uncheckthis-file"
						data-url="http://download.com" onclick="uncheckDownloadlist(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
				</div>
			</li>
			<li class="storageitem">
				<div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" data-code="12" data-group="B" onclick="test(this, event)">
					<div class="filetype-icon">
						<i class="fas fa-folder"></i>
					</div>
					<div class="fileitem-info">
						<span class="fileitem-name">업무 보고</span>
					</div>
					<button type="button" class="checkthis-file"
						data-url="http://download.com" onclick="downloadlist(this)"
						onmouseover="listaddOver(this)" onmouseout="listaddOut(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
					<button type="button" class="uncheckthis-file"
						data-url="http://download.com" onclick="uncheckDownloadlist(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
				</div>
			</li>
			<li class="storageitem">
				<div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" data-code="7" data-group="B" onclick="test(this, event)">
					<div class="filetype-icon">
						<i class="fas fa-folder"></i>
					</div>
					<div class="fileitem-info">
						<span class="fileitem-name">위키</span>
					</div>
					<button type="button" class="checkthis-file"
						data-url="http://download.com" onclick="downloadlist(this)"
						onmouseover="listaddOver(this)" onmouseout="listaddOut(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
					<button type="button" class="uncheckthis-file"
						data-url="http://download.com" onclick="uncheckDownloadlist(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
				</div>
			</li>
			<li class="storageitem">
				<div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" data-code="1" data-group="B" onclick="test(this, event)">
					<div class="filetype-icon">
						<i class="fas fa-folder"></i>
					</div>
					<div class="fileitem-info">
						<span class="fileitem-name">공지</span>
					</div>
					<button type="button" class="checkthis-file"
						data-url="http://download.com" onclick="downloadlist(this)"
						onmouseover="listaddOver(this)" onmouseout="listaddOut(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
					<button type="button" class="uncheckthis-file"
						data-url="http://download.com" onclick="uncheckDownloadlist(this)">
						<div class="filecheck-inner">
							<i class="fas fa-check"></i>
						</div>
					</button>
				</div>
			</li>
		</ul>
		
		<ul class="storagefilelist fileview-grid" onclick="filecheckinit(event)">
			
		</ul>
	</div>
</div>


<form action="" class="downloadfilelist">

</form>

<form action="" class="singlefiledownload">
	<a href="" class="singledownloadtag" onclick="test2(this)"> </a>
</form>

<script type="text/javascript">
$(function () {
    $('.loader-container').fadeOut()
})

function storageAllcheck(input){
    if($(input).prop('checked')){
        $('.checkthis-file').click();
    }else{
        $('.uncheckthis-file').click();
    }
}

function showcheck(input) {
    $(input).children('.checkthis-file').show();
};

function hidecheck(input) {
    $(input).children('.checkthis-file').hide();
};

function listaddOver(input) {
    $(input).children('.filecheck-inner').css("background", "#9bc6ff")
}

function listaddOut(input) {
    $(input).children('.filecheck-inner').css("background", "#bdbdbd")
}

function filecheckinit(e){
    if($(e.target).hasClass('storageinner-content') || $(e.target).hasClass('storageitemlist') || $(e.target).hasClass('filesel-init')){
        $('.uncheckthis-file').hide();
        $('.checkthis-file').hide();
        $('.filetype-icon').removeClass('checked-thisfile');
        $('.downloadfilelist').children().remove();

        uploadtype();
    }
}

// 다운로드 폼에 추가 할때
function downloadlist(input) {
    let url = $(input).data("url");

    let urltemplate = filedownURLItem(url);
    $(urltemplate).text(url);
    $('.downloadfilelist').append(urltemplate);

    $(input).siblings('.filetype-icon').addClass('checked-thisfile');
    $(input).siblings('.uncheckthis-file').children('.filecheck-inner').addClass('checkedfile');
    $(input).siblings('.uncheckthis-file').css("display","flex");
    $(input).hide();

    uploadtype();
}

// 다운로드 폼에서 삭제할 때
function uncheckDownloadlist(input) {
    let url = $(input).data("url");

    $('.downloadfilelist').children('a[href=' + '"' + url + '"' + ']').remove();

    $(input).siblings('.filetype-icon').removeClass('checked-thisfile');
    $(input).siblings('.checkthis-file').css("display","flex");
    $(input).hide();

    uploadtype();
}

function uploadtype() {
    let urlLength = $('.downloadfilelist').children('a');
    if (urlLength.length > 0) {
        $('.storage-download').css("display", "inline-flex");
        $('.storage-delete').css("display", "inline-flex");
        $('.storage-upload').hide();
        $('.filesel-count').text(urlLength.length)
        $('.fileselect-message').css("display", "flex");
    } else {
        $('.storage-upload').css("display", "inline-flex");
        $('.storage-delete').hide();
        $('.storage-download').hide();
        $('.fileselect-message').hide();
    }
}

function filedownURLItem(url) {
    let template = $('<a href="" class="donwloadURL"></a>')
    $(template).attr('href', url);
    return template;
}

function test(input, e){
	let target = $(e.target);
	if(target.hasClass('fa-check') || target.hasClass('filecheck-inner') || target.hasClass('checkedfile') || target.hasClass('checkkthis-file') || target.hasClass('uncheckthis-file')){
		return;
	}
	
	let code = $(input).data("code");
	let group = $(input).data("group");
	let param = `${param.proId }`
	let data = null;
	
	$.ajax({
   		url: '${pageContext.request.contextPath}/storage/storageViewFiles.do',
   		type: 'POST',
   		aysnc: false,
   		data: {"proId":param,
   			   "typeCode":code,
   			   "groupCode":group},
   		dataType: 'json',
   		success : function(resp){
   			$('.storageitemlist').hide();
   			$('.storagefilelist').children().remove();
   			$('.storagefilelist').show();
   			console.log(resp.projectFiles.attatchList);
   			
			data = resp.projectFiles.attatchList;
			
			$(data).each(function(index, item){
				let template = fileTemplate(data[index]);
	   			$('.storagefilelist').append(template);
			})
   		},
   		error : function(error){
   			console.log(error)
   		}
   	})	
}

function fileTemplate(att){
	let template = $('<li class="storageitem"> <div class="filedownload-btn" onmouseover="showcheck(this)" onmouseout="hidecheck(this)" onclick="singlefileDownload(this)"> <div class="filetype-icon"> <i class="fas fa-file-alt"></i> </div> <div class="fileitem-info"> <span class="fileitem-name"></span><span class="fileitem-size"></span> </div> <button type="button" class="checkthis-file" data-url="http://download.com" onclick="downloadlist(this)" onmouseover="listaddOver(this)" onmouseout="listaddOut(this)"> <div class="filecheck-inner"> <i class="fas fa-check"></i> </div> </button> <button type="button" class="uncheckthis-file" data-url="http://download.com" onclick="uncheckDownloadlist(this)"> <div class="filecheck-inner"> <i class="fas fa-check"></i> </div> </button> </div> </li>')
	
	$(template).children('.filedownload-btn').attr("data-url",'http://localhost'+'${pageContext.request.contextPath}/board/download.do?'+'attNo='+att.attNo);
	$(template).children('.filedownload-btn').children('.fileitem-info').children('.fileitem-name').text(att.attOriginname);
	$(template).children('.filedownload-btn').children('.fileitem-info').children('.fileitem-size').text(att.attFancy);
	
	return template;
}

// 파일 다운로드
function singlefileDownload(input){
	let url = $(input).data("url");
	$('.singledownloadtag').attr("href",url);
	$('.singledownloadtag').get(0).click();
}
</script>
